const passport=require("passport"),LocalStrategy=require("passport-local").Strategy,Models=require("./models.js"),passportJWT=require("passport-jwt");let Users=Models.User,JWTStrategy=passportJWT.Strategy,ExtractJWT=passportJWT.ExtractJwt;passport.use(new LocalStrategy({usernameField:"Username",passwordField:"Password"},async(s,e,r)=>{console.log(`${s} ${e}`),await Users.findOne({Username:s}).then(s=>s?s.validatePassword(e)?(console.log("finished"),r(null,s)):(console.log("incorrect password"),r(null,!1,{message:"Incorrect password."})):(console.log("incorrect username"),r(null,!1,{message:"Incorrect username or password."}))).catch(s=>{if(s)return console.log(s),r(s)})})),passport.use(new JWTStrategy({jwtFromRequest:ExtractJWT.fromAuthHeaderAsBearerToken(),secretOrKey:"JOB"},async(s,e)=>await Users.findById(s._id).then(s=>e(null,s)).catch(s=>e(s))));